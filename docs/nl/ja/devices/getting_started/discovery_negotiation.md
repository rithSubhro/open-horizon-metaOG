---

copyright:
years: 2019
lastupdated: "2019-06-28"

---

{:new_window: target="blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:child: .link .ulchildlink}
{:childlinks: .ullinks}

# ディスカバリーおよびネゴシエーション
{: #discovery_negotiation}

{{site.data.keyword.edge_devices_notm}} は、{{site.data.keyword.horizon_open}} プロジェクトに基づいており、主として非集中化されていて、分散されています。 自律的なエージェントおよび合意ボット (agbot) のプロセスが、すべての登録されているエッジ・ノードのソフトウェア管理についてコラボレーションします。
{:shortdesc}

{{site.data.keyword.horizon_open}} プロジェクトについて詳しくは、[{{site.data.keyword.horizon_open}}](https://github.com/open-horizon/) を参照してください。

自律的なエージェント・プロセスは、各 Horizon エッジ・ノードで実行され、エッジ・マシン所有者によって設定されたポリシーを適用します。

同時に、各ソフトウェア・デプロイメント・パターンに割り当てられた自律的な agbot プロセスが、割り当てられたパターンに対して定義されたポリシーを使用して、そのパターン用に登録されているエッジ・ノード・エージェントを検索します。 これらの自律的な agbot とエージェントは、個別にエッジ・マシン所有者のポリシーに従って、コラボレーションのために正式な合意をネゴシエーションします。 agbot とエージェントは、合意状態のときには常に連携して、対応するエッジ・ノードのソフトウェア・ライフサイクルを管理します。

agbot とエージェントは、以下の中央集中サービスを使用して、{{site.data.keyword.edge_devices_notm}} で相手を検索し、信頼を確立して、セキュアに通信します。

* {{site.data.keyword.horizon_switch}}。agbot とエージェントの間のセキュアなピアツーピアのプライベート通信を可能にします。
* {{site.data.keyword.horizon_exchange}}。ディスカバリーを支援します。

<img src="../../images/edge/distributed.svg" width="90%" alt="中央集中サービスおよび非集中型のサービス">

## {{site.data.keyword.horizon_exchange}}

{{site.data.keyword.horizon_exchange}} により、エッジ・マシン所有者は、ソフトウェア・ライフサイクル管理用にエッジ・ノードを登録できます。 {{site.data.keyword.edge_devices_notm}} の {{site.data.keyword.horizon_exchange}} にエッジ・ノードを登録する際、エッジ・ノードのデプロイメント・パターンを指定します。 デプロイメント・パターンは、エッジ・ノード、暗号的に署名されたソフトウェア・マニフェスト、および関連する構成を管理するためのポリシーのセットです。 デプロイメント・パターンは、{{site.data.keyword.horizon_exchange}} で設計、開発、テスト、署名、および公開する必要があります。

各エッジ・ノードは、エッジ・マシン所有者の組織の下で {{site.data.keyword.horizon_exchange}} に登録する必要があります。 各エッジ・ノードは、そのノードにのみ適用できる ID およびセキュリティー・トークンで登録されます。 ノードを登録して、自分の組織によって提供されたソフトウェア・デプロイメント・パターン、またはデプロイメント・パターンが公開されている場合に別の組織によって提供されたパターンを実行できます。

デプロイメント・パターンが {{site.data.keyword.horizon_exchange}} に公開されると、そのデプロイメント・パターンおよび関連ポリシーを管理するように 1 つ以上の agbot が割り当てられます。 これらの agbot は、デプロイメント・パターンに登録されているエッジ・ノードを検出しようとします。 登録されているエッジ・ノードが見つかると、agbot はエッジ・ノードのローカル・エージェント・プロセスとネゴシエーションします。

{{site.data.keyword.horizon_exchange}} によって agbot は登録されているデプロイメント・パターンに対応しているエッジ・ノードを検出できますが、{{site.data.keyword.horizon_exchange}} は、エッジ・ノード・ソフトウェア管理プロセスに直接は関与しません。 agbot およびエージェントが、ソフトウェア管理プロセスを処理します。 {{site.data.keyword.horizon_exchange}} は、エッジ・ノードでの権限を一切備えておらず、エッジ・ノード・エージェントとの通信を開始することもありません。

## {{site.data.keyword.horizon_switch}}

agbot は、{{site.data.keyword.horizon_exchange}} に定期的にポーリングして、デプロイメント・パターンに登録されているすべてのエッジ・ノードを検出します。 agbot は、そのデプロイメント・パターンに登録されているエッジ・ノードを検出すると、{{site.data.keyword.horizon}} スイッチボードを使用して、そのノード上のエージェントにプライベート・メッセージを送信します。 このメッセージでは、エッジ・ノードのソフトウェア・ライフサイクル管理についてコラボレーションするようにエージェントに要求します。 一方、エージェントは、agbot からのメッセージがないか、{{site.data.keyword.horizon_switch}} のプライベート・メールボックスにポーリングします。 メッセージを受信すると、エージェントは復号、検証を行ってから、応答して要求を受け入れます。

各 agbot は、{{site.data.keyword.horizon_exchange}} へのポーリングに加え、{{site.data.keyword.horizon_switch}} 内の自身のプライベート・メールボックスにもポーリングします。 agbot がエージェントから要求の受け入れを受信すると、ネゴシエーションは完了します。

エージェントと agbot はいずれも、公開鍵を {{site.data.keyword.horizon_switch}} と共有することで、セキュアなプライベート通信を有効にします。 この暗号化では、{{site.data.keyword.horizon_switch}} はメールボックス・マネージャーの役割のみを果たします。 すべてのメッセージは、{{site.data.keyword.horizon_switch}} に送信される前に、送信側によって暗号化されます。 {{site.data.keyword.horizon_switch}} はメッセージを復号できません。 ただし、受信側は、自身の公開鍵を使用して暗号化されたすべてのメッセージを復号できます。 また、受信側は送信側の公開鍵を使用して、送信側に対する受信側からの応答を暗号化します。

**注:** すべての通信は {{site.data.keyword.horizon_switch}} によって仲介されるため、エッジ・ノードの IP アドレスは、各エッジ・ノード上のエージェントがその情報を公開するまで、agbot に対して公開されません。 エージェントは、エージェントと agbot が合意のネゴシエーションに成功したときにその情報を公開します。

## ソフトウェア・ライフサイクル管理

特定のデプロイメント・パターンで {{site.data.keyword.horizon_exchange}} にエッジ・ノードが登録されると、そのデプロイメント・パターンの agbot が、そのエッジ・ノード上のエージェントを検出できます。 そのデプロイメント・パターンの agbot は {{site.data.keyword.horizon_exchange}} を使用してエージェントを検出し、{{site.data.keyword.horizon_switch}} を使用して、ソフトウェア管理についてコラボレーションするためにエージェントとネゴシエーションします。

エッジ・ノード・エージェントは、agbot からのコラボレーションの要求を受信し、その提案を評価して、エッジ・ノード所有者によって定義されたポリシーに準拠しているかを確認します。 エージェントは、ローカルにインストールされた鍵ファイルを使用して暗号署名を検証します。 その提案がローカル・ポリシーに従って受け入れ可能であり、署名が検証されると、エージェントは提案を受け入れ、エージェントと agbot は合意に達します。 

合意がある状態では、agbot とエージェントはコラボレーションして、エッジ・ノード上のデプロイメント・パターンのソフトウェア・ライフサイクルを管理します。 agbot は、デプロイメント・パターンが時間の経過とともに変わっていく都度詳細を提供し、エッジ・ノードでコンプライアンスをモニターします。 エージェントは、ソフトウェアをエッジ・ノード上にローカルでダウンロードし、ソフトウェアの署名を検証し、承認された場合はソフトウェアを実行してモニターします。 必要に応じて、エージェントはソフトウェアを更新し、適切な場合はソフトウェアを停止します。

ソフトウェア管理プロセスについて詳しくは、『[エッジ・ソフトウェア管理](edge_software_management.md)』を参照してください。
