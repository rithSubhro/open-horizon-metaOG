---

copyright:
years: 2019
lastupdated: "2019-06-28"

---

{:new_window: target="blank"}
{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:child: .link .ulchildlink}
{:childlinks: .ullinks}

# エッジ・ソフトウェア管理
{: #edge_software_mgmt}

{{site.data.keyword.edge_devices_notm}} は、地理的に分散した自律的なプロセスを利用して、すべてのエッジ・ノードのソフトウェア・ライフサイクルを管理します。
{:shortdesc}

エッジ・ノード・ソフトウェア管理を処理する自律的なプロセスでは、{{site.data.keyword.horizon_exchange}} サービスおよび {{site.data.keyword.horizon_switch}} サービスを使用することで、自分のアドレスを公開することなく、インターネット上で互いを検出します。 相互に検出された後に、プロセスは {{site.data.keyword.horizon_exchange}} および {{site.data.keyword.horizon_switch}} を使用して、関係をネゴシエーションしてから、コラボレーションしてエッジ・ノード・ソフトウェアを管理します。 詳しくは、『[ディスカバリーおよびネゴシエーション](discovery_negotiation.md)』を参照してください。

任意のホスト上の {{site.data.keyword.horizon}} ソフトウェアが、エッジ・ノード・エージェントまたは agbot、あるいはその両方として機能できます。

## agbot (合意ボット)

agbot インスタンスは、{{site.data.keyword.horizon_exchange}} に公開された {{site.data.keyword.edge_devices_notm}} の各ソフトウェア・デプロイメント・パターンを管理するために中央に作成されます。 ユーザーまたは開発者の 1 人が、{{site.data.keyword.horizon_exchange}} および {{site.data.keyword.horizon_switch}} にアクセスできる任意のマシンで agbot プロセスを実行することもできます。

agbot が開始され、特定のソフトウェア・デプロイメント・パターンを管理するように構成されている場合、agbot は {{site.data.keyword.horizon_exchange}} に登録して、同じデプロイメント・パターンを実行するように登録されたエッジ・ノードに対するポーリングを開始します。 エッジ・ノードが検出されると、agbot は、そのエッジ・ノード上のローカル・エージェントに対して、ソフトウェアの管理についてコラボレーションするように求める要求を送信します。

合意のネゴシエーション時に、agbot は以下の情報をエージェントに送信します。

* デプロイメント・パターンに含まれているポリシーの詳細。
* デプロイメント・パターンに含まれている {{site.data.keyword.horizon}} サービスおよびバージョンのリスト。
* これらのサービス間の依存関係。
* サービスの共有可能性。 サービスは、`exclusive`、`singleton`、または `multiple` として設定できます。
* 各サービスの各コンテナーに関する詳細。 この詳細には、以下の情報が含まれます。 
  * パブリック DockerHub レジストリーやプライベート・レジストリーなど、コンテナーが登録されている Docker レジストリー。
  * プライベート・レジストリーのレジストリー資格情報。
  * 構成およびカスタマイズのためのシェル環境の詳細。
  * コンテナーおよびその構成の暗号的に署名されたハッシュ。

agbot は、{{site.data.keyword.horizon_exchange}} 内のソフトウェア・デプロイメント・パターンに変更がないか (パターンについて {{site.data.keyword.horizon}} サービスの新規バージョンが公開されていないか) をモニターし続けます。 変更が検出された場合、agbot は再び、パターンに対して登録されている各エッジ・ノードに、新しいソフトウェア・バージョンへの移行の管理についてコラボレーションするように求める要求を送信します。

また、agbot は、デプロイメント・パターンに対して登録されている各エッジ・ノードを定期的に検査して、パターンのポリシーが適用されていることを確認します。 ポリシーが適用されていない場合、agbot はネゴシエーション済みの合意を停止できます。 例えば、エッジ・ノードがデータの送信を停止したり、長期間にわたってハートビートを提供しなかったりした場合、agbot は合意をキャンセルできます。  

### エッジ・ノード・エージェント

エッジ・ノード・エージェントは、{{site.data.keyword.horizon}}  ソフトウェア・パッケージがエッジ・マシンにインストールされるときに作成されます。 ソフトウェアのインストールについて詳しくは、『[{{site.data.keyword.horizon}} ソフトウェアのインストール](../installing/adding_devices.md)』を参照してください。

後で {{site.data.keyword.horizon_exchange}}にエッジ・ノードを登録する場合は、以下の情報を指定する必要があります。

* {{site.data.keyword.horizon_exchange}} URL。
* エッジ・ノードのエッジ・ノード名およびアクセス・トークン。
* エッジ・ノードで実行するソフトウェア・デプロイメント・パターン。 パターンを識別するために組織とパターン名の両方を指定する必要があります。

登録について詳しくは、『[エッジ・マシンの登録](../installing/registration.md)』を参照してください。

エッジ・ノードが登録された後、ローカル・エージェントは、リモート agbot プロセスからのコラボレーション要求がないか、{{site.data.keyword.horizon_switch}} にポーリングします。 エージェントが、構成済みのデプロイメント・パターンの agbot によって検出されると、agbot はエッジ・ノード・エージェントに要求を送信して、エッジ・ノードのソフトウェア・ライフサイクル管理についてコラボレーションするようにネゴシエーションします。 合意に達すると、agbot はエッジ・ノードに情報を送信します。

エージェントは、指定された Docker コンテナーを適切なレジストリーからプルします。 次に、エージェントは、コンテナー・ハッシュおよび暗号署名を検証します。 その後、エージェントは、指定された環境構成を使用して、依存関係の逆順にコンテナーを開始します。 コンテナーが実行中の場合、ローカル・エージェントはコンテナーをモニターします。 コンテナーが予期せず実行を停止すると、エージェントはコンテナーを再起動して、エッジ・ノードでデプロイメント・パターンが完全な状態で保たれるようにしようとします。

### {{site.data.keyword.horizon}} サービスの依存関係

{{site.data.keyword.horizon}} エージェントは、割り当てられたデプロイメント・パターンのコンテナーを開始および管理するために機能しますが、サービス間の依存関係は、サービス・コンテナー・コードで管理する必要があります。 コンテナーが依存関係の逆順で開始されていても、{{site.data.keyword.horizon}} は、サービス・コンシューマーが開始される前にサービス・プロバイダーが完全に開始され、サービスを提供する準備ができているかを確認できません。 コンシューマーは、依存しているサービスの開始が遅くなる可能性を戦略的に処理する必要があります。 サービスを提供するコンテナーで障害が発生してコンテナーが無効になる可能性があるため、サービス・コンシューマーは、コンシュームするサービスの欠落を処理する必要もあります。 

ローカル・エージェントは、サービスが異常終了するとそのことを検出し、同じ Docker プライベート・ネットワークで同じネットワーク名を使用してサービスを開始します。 再起動プロセス時に短いダウン時間が発生します。 コンシューム・サービスは短いダウン時間を処理する必要もあり、またはコンシューム・サービスでも障害が発生する可能性があります。

エージェントの障害に対する許容度は限定されています。 コンテナーが繰り返しすぐに異常終了している場合、エージェントは絶えず障害が発生しているサービスの再始動をやめ、合意をキャンセルすることがあります。

### {{site.data.keyword.horizon}} Docker ネットワーキング

{{site.data.keyword.horizon}} は、Docker ネットワーキング機能を使用して、サービスを提供する Docker コンテナーを分離します。 この分離により、許可されたコンシューマーのみがコンテナーにアクセスできるようになります。 各コンテナーは、別個のプライベート Docker 仮想ネットワークで依存関係の逆順に (プロデューサーが先で、コンシューマーが後に) 開始されます。 サービスをコンシュームするコンテナーは、開始されると常に、そのプロデューサー・コンテナーのプライベート・ネットワークに接続されます。 プロデューサー・コンテナーに到達できるのは、そのプロデューサーへの依存関係が {{site.data.keyword.horizon}} に認識されているコンシューマーのみです。 Docker ネットワークの実装方法のおかげで、すべてのコンテナーはホスト・シェルから到達できます。 

コンテナーの IP アドレスを取得する必要がある場合は、`docker inspect <containerID>` コマンドを使用して、割り当てられている `IPAddress` を取得できます。 ホスト・シェルから任意のコンテナーに到達できます。

## セキュリティーおよびプライバシー

エッジ・ノード・エージェントとデプロイメント・パターン agbot は相互に検出可能ですが、コラボレーションの合意が正式にネゴシエーションされるまで、コンポーネントは完全にプライバシーを維持します。 エージェントおよび agbot の ID およびすべての通信は暗号化されます。 ソフトウェア管理のコラボレーションも暗号化されます。 管理されているすべてのソフトウェアは暗号的に署名されます。 {{site.data.keyword.edge_devices_notm}} のプライバシーおよびセキュリティーの側面について詳しくは、『[セキュリティーおよびプライバシー](../user_management/security_privacy.md)』を参照してください。
